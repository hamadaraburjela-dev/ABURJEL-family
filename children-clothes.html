<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تسجيل بنزط أطفال - عائلة أبو رجيلة</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh;">
  <header class="text-center py-4">
    <div class="container">
      <img src="logo.webp" alt="شعار عائلة أبو رجيلة" class="mb-3" style="width:80px;height:80px" />
      <h1 class="h3 mb-2">عائلة أبو رجيلة (قديح)</h1>
      <p class="text-muted">تسجيل احتياجات بنزط/ملابس الأطفال</p>
    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="refresh" content="0; url=index.html" />
      <title>غير متاح</title>
      <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; display: grid; place-items: center; min-height: 100vh; background: #f7f7fb; margin: 0; }
        .box { text-align: center; background: white; padding: 24px 28px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
      </style>
      <link rel="canonical" href="index.html" />
    </head>
    <body>
      <div class="box">
        <h2>هذه الصفحة غير متاحة</h2>
        <p>سيتم تحويلك للواجهة الرئيسية الآن...</p>
        <p><a href="index.html">الانتقال يدوياً</a></p>
      </div>
    </body>
    </html>
        }
        return data;
      }

      // Only digits for id/phone
      document.getElementById('idNumber').addEventListener('input', e => e.target.value = e.target.value.replace(/[^0-9]/g, ''));
      document.getElementById('phone').addEventListener('input', e => e.target.value = e.target.value.replace(/[^0-9+]/g, ''));

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!form.checkValidity()) { form.classList.add('was-validated'); return; }
        const btn = form.querySelector('button[type="submit"]');
        const spinner = btn.querySelector('.spinner-border');
        const textSpan = btn.querySelector('.button-text');
        spinner.classList.remove('d-none');
        btn.disabled = true;
        textSpan.textContent = 'جاري الإرسال...';

        try {
          const payload = {
            action: 'submitChildrenClothes',
            idNumber: document.getElementById('idNumber').value,
            fullName: document.getElementById('fullName').value,
            phone: document.getElementById('phone').value,
            address: document.getElementById('address').value,
            childrenCount: document.getElementById('childrenCount').value,
            sizesDetails: document.getElementById('sizesDetails').value,
            priority: document.getElementById('priority').value,
            notes: document.getElementById('notes').value
          };
          const result = await postJson(payload);
          if (!result.success) throw new Error(result.message || 'فشل إرسال الطلب');
          if (window.App && App.showDialog) {
            App.showDialog({ type: 'success', title: 'تم إرسال الطلب', message: result.message || 'تم استلام طلبك.' });
          } else if (window.App && App.showToast) {
            App.showToast(result.message || 'تم استلام طلبك.', true);
          }
          form.reset();
          form.classList.remove('was-validated');
        } catch (err) {
          if (window.App && App.showDialog) {
            App.showDialog({ type: 'danger', title: 'تعذّر الإرسال', message: err.message || 'حدث خطأ غير متوقع.' });
          } else if (window.App && App.showToast) {
            App.showToast(err.message || 'تعذّر الإرسال', false);
          } else {
            console.error(err);
          }
        } finally {
          spinner.classList.add('d-none');
          btn.disabled = false;
          textSpan.textContent = 'إرسال الطلب';
        }
      });
    });
  </script>
</body>
</html>
