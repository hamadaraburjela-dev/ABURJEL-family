<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯ - Ø¹Ø§Ø¦Ù„Ø© Ø£Ø¨Ùˆ Ø±Ø¬ÙŠÙ„Ø©</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh;">
  
  <!-- Header -->
  <header class="text-center py-4">
    <div class="container">
      <img src="logo.webp" alt="Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¦Ù„Ø© Ø£Ø¨Ùˆ Ø±Ø¬ÙŠÙ„Ø©" class="mb-3" style="width: 80px; height: 80px;" />
      <h1 class="h3 mb-2">Ø¹Ø§Ø¦Ù„Ø© Ø£Ø¨Ùˆ Ø±Ø¬ÙŠÙ„Ø© (Ù‚Ø¯ÙŠØ­)</h1>
      <!-- Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© -->
      <div class="mt-5 mx-auto" style="max-width: 700px;">
        <div class="card shadow-lg border-0 pulse-card" style="border-radius: 20px; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b9d 100%);">
          <!DOCTYPE html>
          <html lang="ar" dir="rtl">
          <head>
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø²Ø· Ø£Ø·ÙØ§Ù„</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
            <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
            <link rel="stylesheet" href="style.css" />
          </head>
          <body style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh;">
            <header class="text-center py-4">
              <div class="container">
                <img src="logo.webp" alt="Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¦Ù„Ø© Ø£Ø¨Ùˆ Ø±Ø¬ÙŠÙ„Ø©" class="mb-3" style="width:80px;height:80px" />
                <h1 class="h3 mb-2">Ø¹Ø§Ø¦Ù„Ø© Ø£Ø¨Ùˆ Ø±Ø¬ÙŠÙ„Ø© (Ù‚Ø¯ÙŠØ­)</h1>
                <p class="text-muted">ØªØ³Ø¬ÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø¨Ù†Ø²Ø·/Ù…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø£Ø·ÙØ§Ù„</p>
              </div>
            </header>

            <main class="container" style="max-width:900px;">
              <div class="card shadow-lg" style="border-radius: 15px; border: none;">
                <div class="card-header text-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px 15px 0 0;">
                  <h2 class="mb-0">ğŸ§’ ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø²Ø· Ø£Ø·ÙØ§Ù„</h2>
                  <small class="opacity-75">Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ</small>
                </div>
                <div class="card-body p-4">
                  <form id="clothesForm" class="needs-validation" novalidate>
                    <div class="row g-3">
                      <div class="col-md-6">
                        <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©<span class="text-danger"> *</span></label>
                        <input id="idNumber" class="form-control" maxlength="9" pattern="[0-9]{9}" placeholder="9 Ø£Ø±Ù‚Ø§Ù…" required />
                        <div class="invalid-feedback">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ØµØ­ÙŠØ­ (9 Ø£Ø±Ù‚Ø§Ù…)</div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„<span class="text-danger"> *</span></label>
                        <input id="fullName" class="form-control" placeholder="Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ" required />
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„<span class="text-danger"> *</span></label>
                        <input id="phone" class="form-control" placeholder="05XXXXXXXX" required />
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold">Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</label>
                        <input id="address" class="form-control" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ø´Ø§Ø±Ø¹" />
                      </div>
                      <div class="col-md-4">
                        <label class="form-label fw-bold">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„<span class="text-danger"> *</span></label>
                        <input id="childrenCount" type="number" min="1" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 3" required />
                        <div class="invalid-feedback">Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯Ø§Ù‹ ØµØ­ÙŠØ­Ø§Ù‹</div>
                      </div>
                      <div class="col-md-8">
                        <label class="form-label fw-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</label>
                        <textarea id="sizesDetails" class="form-control" rows="2" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù…Ø± 5 Ø³Ù†ÙˆØ§Øª (L)ØŒ Ø¹Ù…Ø± 8 Ø³Ù†ÙˆØ§Øª (XL)..."></textarea>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select id="priority" class="form-select">
                          <option value="Ø¹Ø§Ø¯ÙŠ" selected>Ø¹Ø§Ø¯ÙŠ</option>
                          <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
                          <option value="Ø¹Ø§Ø¬Ù„">Ø¹Ø§Ø¬Ù„</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold">Ù…Ø±ÙÙ‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input id="attachment" type="file" class="form-control" accept="image/*,.pdf" />
                      </div>
                      <div class="col-12">
                        <label class="form-label fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="notes" class="form-control" rows="2"></textarea>
                      </div>
                    </div>
                    <div class="d-flex justify-content-end gap-2 mt-4">
                      <a href="wounded-form.html" class="btn btn-outline-secondary">Ø¹ÙˆØ¯Ø©</a>
                      <button type="submit" class="btn btn-primary">
                        <span class="spinner-border spinner-border-sm d-none me-2"></span>
                        <span class="button-text">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</span>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </main>

            <footer class="footer">
              <div id="server-status" class="status-indicator mb-2">
                <span class="status-dot"></span>
                <span class="status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…...</span>
              </div>
              <p class="copyright-text mb-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2025 | Ù…. Ø­Ù…Ø§Ø¯Ù‡ Ø£Ø¨Ùˆ Ø±Ø¬ÙŠÙ„Ø©</p>
              <a href="https://wa.me/972569210941" target="_blank" class="whatsapp-link">
                <i class="bi bi-whatsapp"></i> ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
              </a>
            </footer>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
            <script src="script.js"></script>
            <script>
              document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById('clothesForm');
                const attachmentInput = document.getElementById('attachment');

                const WEB_APP_URL = (window.App && App.WEB_APP_URL)
                  ? App.WEB_APP_URL
                  : 'https://script.google.com/macros/s/AKfycbxiyJpbfDqZzpOoBuVEnOPJvsfzV8QT9-6M4wMNe23vzIl251xFI5jVNGtWrfcjp4OplQ/exec';

                const toBase64Payload = (file) => new Promise((resolve) => {
                  if (!file) { resolve(null); return; }
                  const reader = new FileReader();
                  reader.onload = () => {
                    const result = reader.result;
                    const base64Data = String(result).substring(String(result).indexOf(',') + 1);
                    resolve({ name: file.name, mimeType: file.type, data: base64Data });
                  };
                  reader.onerror = () => resolve(null);
                  reader.readAsDataURL(file);
                });

                async function postJson(payload) {
                  const res = await fetch(WEB_APP_URL, { method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(payload) });
                  const raw = await res.text();
                  let data = null;
                  try { data = raw ? JSON.parse(raw) : null; } catch { data = null; }
                  if (!res.ok) {
                    const snippet = raw ? raw.slice(0, 200) : '';
                    throw new Error((data && data.message) || snippet || `HTTP ${res.status}`);
                  }
                  if (!data) {
                    const snippet = raw ? raw.slice(0, 200) : '';
                    const looksHtml = /^\s*<!DOCTYPE|^\s*<html|^\s*<HTML/i.test(snippet);
                    const authHint = /Authorization|login|Sign in|requires authentication|OAuth/i.test(snippet);
                    const hint = looksHtml && authHint ? 'ÙŠØ­ØªØ§Ø¬ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø±/ØªÙÙˆÙŠØ¶ ØµÙ„Ø§Ø­ÙŠØ§Øª.' : '';
                    throw new Error(hint || 'Ø±Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….');
                  }
                  return data;
                }

                // Only digits for id/phone
                document.getElementById('idNumber').addEventListener('input', e => e.target.value = e.target.value.replace(/[^0-9]/g, ''));
                document.getElementById('phone').addEventListener('input', e => e.target.value = e.target.value.replace(/[^0-9+]/g, ''));

                form.addEventListener('submit', async (e) => {
                  e.preventDefault();
                  if (!form.checkValidity()) { form.classList.add('was-validated'); return; }
                  const btn = form.querySelector('button[type="submit"]');
                  const spinner = btn.querySelector('.spinner-border');
                  const textSpan = btn.querySelector('.button-text');
                  spinner.classList.remove('d-none');
                  btn.disabled = true;
                  textSpan.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

                  try {
                    const attachment = await toBase64Payload(attachmentInput.files[0]);
                    const payload = {
                      action: 'submitChildrenClothes',
                      idNumber: document.getElementById('idNumber').value,
                      fullName: document.getElementById('fullName').value,
                      phone: document.getElementById('phone').value,
                      address: document.getElementById('address').value,
                      childrenCount: document.getElementById('childrenCount').value,
                      sizesDetails: document.getElementById('sizesDetails').value,
                      priority: document.getElementById('priority').value,
                      notes: document.getElementById('notes').value,
                      attachment
                    };
                    const result = await postJson(payload);
                    if (!result.success) throw new Error(result.message || 'ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨');
                    if (window.App && App.showDialog) {
                      App.showDialog({ type: 'success', title: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', message: result.message || 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ.' });
                    } else if (window.App && App.showToast) {
                      App.showToast(result.message || 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨.', true);
                    }
                    form.reset();
                    form.classList.remove('was-validated');
                  } catch (err) {
                    if (window.App && App.showDialog) {
                      App.showDialog({ type: 'danger', title: 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', message: err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.' });
                    } else if (window.App && App.showToast) {
                      App.showToast(err.message || 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', false);
                    } else {
                      console.error(err);
                    }
                  } finally {
                    spinner.classList.add('d-none');
                    btn.disabled = false;
                    textSpan.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨';
                  }
                });
              });
            </script>
          </body>
          </html>
    ? App.WEB_APP_URL
